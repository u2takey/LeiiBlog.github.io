<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>LeiiWang&#39;s Blog</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.17-DEV" />
        


        
        
            
                <meta name="description" content="Theme ported by Julio Pescador. Powered by Hugo">
            
        

        
        <meta property="og:title" content="LeiiWang&#39;s Blog" />
<meta property="og:description" content="Theme ported by Julio Pescador. Powered by Hugo" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://u2takey.github.io/" />


<meta property="og:updated_time" content="2016-07-31T00:00:00&#43;00:00"/>









        
<meta itemprop="name" content="LeiiWang&#39;s Blog">
<meta itemprop="description" content="Theme ported by Julio Pescador. Powered by Hugo">


        

        

        
        
            
        

        
        

        
            
                
                    <link rel="stylesheet" href="/css/main.min.css" />
                
            
        

        
        
        
            
        
    </head>
    <body>

        
        <div id="wrapper">

    
    
<header id="header">
    
        <h1><a href="/">LeiiWang&#39;s Blog</i></a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/blog">
                        
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories">
                        Categories
                    </a>
                </li>
            
                <li>
                    <a href="/about">
                        About
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="q" value="site:https://u2takey.github.io/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="q" value="site:https://u2takey.github.io/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/blog">
                            <h3>
                                
                                    <i class="fa fa-newspaper-o">&nbsp;</i>
                                
                                Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            <h3>
                                
                                Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            <h3>
                                
                                About
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section>
            <ul class="links">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    <li>
                        <a href="https://u2takey.github.io/blog/influxdb%E4%B8%AD%E6%96%87%E7%B2%BE%E7%AE%80%E6%96%87%E6%A1%A3/"><p>influxdb中文精简文档</p></a>
                    </li>
                
                    <li>
                        <a href="https://u2takey.github.io/blog/first/"><p>first blog</p></a>
                    </li>
                
                    <li>
                        <a href="https://u2takey.github.io/blog/golang_faq/"><p>Golang笔记之常见问题</p></a>
                    </li>
                
                    <li>
                        <a href="https://u2takey.github.io/blog/launchd/"><p>Launchd Tutorial</p></a>
                    </li>
                
                    <li>
                        <a href="https://u2takey.github.io/blog/coredata/"><p>CoreData概要</p></a>
                    </li>
                
            </ul>
        </section>

    
        
</section>

    
    <div id="main">
        
            <article class="post">
    <header>
    <div class="title">
        
            <h2><a href="https://u2takey.github.io/blog/influxdb%E4%B8%AD%E6%96%87%E7%B2%BE%E7%AE%80%E6%96%87%E6%A1%A3/">influxdb中文精简文档</a></h2>
        
        
    </div>
    <div class="meta">
        
            
        

        <time class="published"
            datetime='2016-07-31'>
            July 31, 2016</time>
        <span class="author">leiiwang</span>
        
        
    </div>
</header>


    <section id="social-share">
        <ul class="icons">
            


<li><a href="//twitter.com/share?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&text=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3&via=" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&title=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&title=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&title=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by leiiwang&body=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
    
    

    
        
        




    
    
        
    


        

        <a href="https://u2takey.github.io/blog/influxdb%E4%B8%AD%E6%96%87%E7%B2%BE%E7%AE%80%E6%96%87%E6%A1%A3/" class="image featured">
            <img src="/img/2016/07/bagan-1137015_960_720.jpg" alt="" />
        </a>
    


    <div id="content">
        

<blockquote>
<p>参考<a href="https://docs.influxdata.com/influxdb/v0.13/">https://docs.influxdata.com/influxdb/v0.13/</a>, 当前版本0.13, 这是一个简化版的文档，摘录文档中我认为比较重要的概念内容,
influxdb目前更新很快，不同版本之间概念差异很大，阅读时请注意当前最新版本。</p>
</blockquote>

<hr />

<!-- vscode-markdown-toc -->

<ul>
<li>1. <a href="#-0">概要</a>

<ul>
<li>1.1. <a href="#-1">简介</a></li>
<li>1.2. <a href="#-2">下载和安装</a></li>
<li>1.3. <a href="#-3">入门</a>

<ul>
<li>1.3.1. <a href="#-4">创建数据库</a></li>
<li>1.3.2. <a href="#-5">读写数据</a></li>
</ul></li>
</ul></li>
<li>2. <a href="#-6">指南</a>

<ul>
<li>2.1. <a href="#-7">写数据</a>

<ul>
<li>2.1.1. <a href="#HTTPAPI-8">使用HTTP API创建数据库</a></li>
<li>2.1.2. <a href="#HTTPAPI-9">使用HTTP API写入数据</a></li>
<li>2.1.3. <a href="#-10">写多个点数据</a></li>
<li>2.1.4. <a href="#-11">从文件中写入点</a></li>
<li>2.1.5. <a href="#SchemalessDesign-12">Schemaless Design</a></li>
<li>2.1.6. <a href="#REST...-13">关于REST&hellip;</a></li>
<li>2.1.7. <a href="#HTTP-14">HTTP响应概要</a></li>
</ul></li>
<li>2.2. <a href="#-15">查询数据</a>

<ul>
<li>2.2.1. <a href="#HTTPAPI-16">使用 HTTP API查询数据</a></li>
<li>2.2.2. <a href="#-17">多个查询</a></li>
<li>2.2.3. <a href="#-18">查询数据的其他选项</a></li>
</ul></li>
<li>2.3. <a href="#DownsamplingandDataRetention-19">缩减采样和数据保留（Downsampling and Data Retention）</a>

<ul>
<li>2.3.1. <a href="#retentionpolicies-20">保留策略retention policies</a></li>
<li>2.3.2. <a href="#-21">连续查询</a></li>
<li>2.3.3. <a href="#RPsandCQs--22">结合 RPs and CQs - 一个案例研究</a></li>
</ul></li>
<li>2.4. <a href="#-23">硬件指南</a></li>
</ul></li>
<li>3. <a href="#-24">概念</a></li>
</ul>

<!-- /vscode-markdown-toc -->

<hr />

<h2 id="1-a-name-0-a-概要">1. <a name='-0'></a>概要</h2>

<h3 id="1-1-a-name-1-a-简介">1.1. <a name='-1'></a>简介</h3>

<p>InfluxDB是一个时间序列数据库，支持高效的写入和查询。 InfluxDB被设计来存储开发监控，应用指标，物联网传感数据，实时分析等产生的大量的时间序列数据。</p>

<p>为什么选择InfluxDB？</p>

<ul>
<li>为高性能数据存储的时间序列数据而编写。使用TSM引擎支持高存取速度和数据压缩。</li>
<li>go语言编写，无外部依赖。</li>
<li>简单高效的HTTP（S）的API。</li>
<li>支持Graphite，collectd和OpenTSDB插件。</li>
<li>高可用性设置（基于Relay）。</li>
<li>类SQL的查询语言，轻松查询汇总数据。</li>
<li>tags支持建立索引，以便快速，高效的查询。</li>
<li>保留策略（Retention policies）有效地自动清理过期数据。</li>
<li>连续查询（Continuous queries）自动汇总数据以提高查询效率。</li>
<li>内置Web管理界面。</li>
</ul>

<h3 id="1-2-a-name-2-a-下载和安装">1.2. <a name='-2'></a>下载和安装</h3>

<p>略</p>

<h3 id="1-3-a-name-3-a-入门">1.3. <a name='-3'></a>入门</h3>

<p>本节使用命令行界面 <code>influx</code>（CLI）作为演示，它已经包含在InfluxDB安装包中了，是与数据库交互的轻量级，简单的方式。 CLI中默认情况通过InfluxDB HTTP API使用端口<code>8086</code>
与InfluxDB通信。</p>

<h4 id="1-3-1-a-name-4-a-创建数据库">1.3.1. <a name='-4'></a>创建数据库</h4>

<p>执行<code>influx</code>命令启动CLI并自动连接到本地InfluxDB实例（假设你已经使用service influxdb start或者直接运行influxd启动了influxdbserver)。输出应该是这样的：</p>

<pre><code>$ influx
Connected to http://localhost:8086 version 0.13.x
InfluxDB shell 0.13.x
&gt;
</code></pre>

<blockquote>
<p>注：InfluxDB HTTP API默认在端口8086运行。因此，influx会默认连接端口<code>8086</code>和<code>localhost</code>。如果您需要更改这些默认设置，运行influx &ndash;help。</p>
</blockquote>

<p>现在你可以使用Influx查询语句了（a.k.a InfluxQL）。要退出InfluxQL shell，键入<code>exit</code>并回车。</p>

<p>新安装的InfluxDB有没有数据库（除了系统的<code>_internal</code>），所以创建先一个。使用<code>CREATE DATABASE  &lt;db-name&gt;</code> 语句创建数据库，其中<DB-name>是您想要创建的数据库
的名称。</p>

<pre><code>&gt; CREATE DATABASE mydb
&gt;
</code></pre>

<blockquote>
<p>注：按下回车键后，出现一个新的提示符，这意味着该语句执行完成，没有任何错误显示。</p>
</blockquote>

<pre><code>&gt; SHOW DATABASES
name: databases
---------------
name
_internal
mydb

&gt;
</code></pre>

<blockquote>
<p>注意：_internal数据库是InfluxDB自动创建并使用来存储内部运行指标的数据库。有兴趣可以看看它了解Influx内部是怎么运行的。</p>
</blockquote>

<p>不同于<code>SHOW DATABASES</code>，大部分的InfluxQL语句必须针对特定的数据库执行。你可以每次查询的时候都指定数据库，CLI提供了一个方便的语句，<code>USE &lt;db-name&gt;</code>，
它会自动为之后的所有请求设置使用的数据库。例如：</p>

<pre><code>&gt; USE mydb
Using database mydb
&gt;
</code></pre>

<p>这之后的命令只会使用mydb数据库运行。</p>

<h4 id="1-3-2-a-name-5-a-读写数据">1.3.2. <a name='-5'></a>读写数据</h4>

<p>现在，我们有数据库了，InfluxDB可以接受查询和写入请求了。</p>

<p>首先，简介一下datastore。在InfluxDB数据由“时间序列”（time series）组织，它包含一个测量值，例如“cpu_load”或“temperature”。时间序列有0到多个点，
一个点对应于一个测量数据。点包括<code>time</code>（时间戳），<code>measurement</code>（如“cpu_load”），至少一个键值字段<code>field</code>
（测量值本身，例如，“value= 0.64”，或“temperature= 21.2”），以及一个或者多个键值标签<code>tags</code>,tags是value的元数据（例如，“host= SERVER01”，“region= EMEA”，
“DC =Frankfurt”）。</p>

<p>从概念上讲，你可以认为<code>measurement</code>是一个SQL表，其主索引始终是时间。<code>tags</code>和<code>field</code>都表中的列。<code>tags</code>有索引，<code>field</code>没有。
不同的是，使用InfluxDB，你可以存储上百万的测量值，而不必提前定义schemas，并且null values 没有被存储。</p>

<p>Points 被使用<code>Line Protocol</code>写入InfluxDB，遵循以下格式：</p>

<pre><code>&lt;measurement&gt;[,&lt;tag-key&gt;=&lt;tag-value&gt;...] &lt;field-key&gt;=&lt;field-value&gt;[,&lt;field2-key&gt;=&lt;field2-value&gt;...] [unix-nano-timestamp]
</code></pre>

<p>以下是可以写入InfluxDB的有效例子：</p>

<pre><code>cpu,host=serverA,region=us_west value=0.64
payment,device=mobile,product=Notepad,method=credit billed=33,licenses=3i 1434067467100293230
stock,symbol=AAPL bid=127.46,ask=127.48
temperature,machine=unit42,type=assembly external=25,internal=37 1434067467000000000
</code></pre>

<p>使用<code>INSERT</code>命令插入一个时间序列点数据</p>

<pre><code>&gt; INSERT cpu,host=serverA,region=us_west value=0.64
&gt;
</code></pre>

<p>一个名称为name,tag 为host，值为value:0.64的数据被插入Db中了，现在可以查询我们刚刚插入的数据：</p>

<pre><code>&gt; SELECT host, region, value FROM cpu
name: cpu
---------
time		    	                     host     	region   value
2015-10-21T19:28:07.580664347Z  serverA	  us_west	 0.64

&gt;
</code></pre>

<blockquote>
<p>注：我们写数据的时候并没有提供一个timestamp。当没有提供timestamp的时候，InfluxDB会自动分配本地当前时间戳。这意味着和你的本地时间戳可能会有所不同。</p>
</blockquote>

<p>存储另一种数据，这个数据有两个fields</p>

<pre><code>&gt; INSERT temperature,machine=unit42,type=assembly external=25,internal=37
&gt;
</code></pre>

<p>使用*运算符查询所有数据：</p>

<pre><code>&gt; SELECT * FROM temperature
name: temperature
-----------------
time		                        	 external	  internal	machine	type
2015-10-21T19:28:08.385013942Z  25	        	37     		unit42  assembly

&gt;
</code></pre>

<p>InfluxQL还有有许多功能和关键字，这里没有覆盖，包括GO风格正则表达式的支持。例如：</p>

<pre><code>&gt; SELECT * FROM /.*/限制1
- 
&gt; SELECT * FROM cpu_load_short
- 
&gt; SELECT * FROM cpu_load_short WHERE值&gt; 0.9
</code></pre>

<h2 id="2-a-name-6-a-指南">2. <a name='-6'></a>指南</h2>

<h3 id="2-1-a-name-7-a-写数据">2.1. <a name='-7'></a>写数据</h3>

<p>可以使用包括命令行界面，客户端库和插件等多种方式向InfluxDB 写入数据。在这里，我们将向你展示如何使用数据库内置的HTTP API来创建数据库和写入数据。</p>

<h4 id="2-1-1-a-name-httpapi-8-a-使用http-api创建数据库">2.1.1. <a name='HTTPAPI-8'></a>使用HTTP API创建数据库</h4>

<p>发送<code>POST</code>请求到<code>/query</code>，并设置URL参数<code>q</code>为<code>CREATE DATABASE</code>创建数据库<code>&lt;new_database_name&gt;</code>：</p>

<pre><code>curl -i -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE mydb&quot;
</code></pre>

<h4 id="2-1-2-a-name-httpapi-9-a-使用http-api写入数据">2.1.2. <a name='HTTPAPI-9'></a>使用HTTP API写入数据</h4>

<p>HTTP API是将数据放入InfluxDB的主要手段。发送<code>POST</code>请求到<code>/write</code>。下面的例子写一个单点mydb数据库。数据为 measurement cpu_load_short，
 tag keys: host, region; tag values : server01, us-west, field key value: value -&gt; 0.64, timestamp : 1434055562000000000</p>

<pre><code>curl -i -XPOST 'http://localhost:8086/write?db=mydb' --data-binary 'cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000'
</code></pre>

<p>写点数据必须指定db参数。这个POST请求的BODY - 我们称之为线路协议- 包含您要保存的时间序列数据。它们由一个测量，标记，字段和时间戳
(measurement, tags, fields, and a timestamp) 组成。 InfluxDB需要一个测量名称(measurement name.)。严格地说，标签是可选的，常使用来区分数据源，并使进行查询既简单又高效。
标签键和标签值都是字符串。fields是必需的，始终是字符串，在默认情况下，字段值是floats。时间戳是可选的。如果不指定时间戳InfluxDB使用服务器的本地Unix纪元纳秒时间戳。
InfluxDB相关的时间都是UTC。</p>

<h4 id="2-1-3-a-name-10-a-写多个点数据">2.1.3. <a name='-10'></a>写多个点数据</h4>

<p>通过换行符分隔多个序列的多个点，这种形式的Batching points可以提高性能。
下面的示例将写三个点到mydb数据库。
第一个点属于cpu_load_short， tag set host=server02， 使用 server’s local timestamp。
第二个点是属于cpu_load_short， tag set host=server02,region=us-west，使用指定的时间戳1422568543702900257。
第三个点具属于cpu_load_short， tag set direction=in,host=server01,region=us-west， 使用指定的时间戳1422568543702900257。</p>

<pre><code>curl -i -XPOST 'http://localhost:8086/write?db=mydb' --data-binary 'cpu_load_short,host=server02 value=0.67
cpu_load_short,host=server02,region=us-west value=0.55 1422568543702900257
cpu_load_short,direction=in,host=server01,region=us-west value=2.0 1422568543702900257'
</code></pre>

<h4 id="2-1-4-a-name-11-a-从文件中写入点">2.1.4. <a name='-11'></a>从文件中写入点</h4>

<p>通过@filename向curl传入文件内容。该文件中的数据应该遵循InfluxDB的 line protocol syntax的语法。正确格式的文件（cpu_data.txt）的例子：</p>

<pre><code>cpu_load_short,host=server02 value=0.67
cpu_load_short,host=server02,region=us-west value=0.55 1422568543702900257
cpu_load_short,direction=in,host=server01,region=us-west value=2.0 1422568543702900257
</code></pre>

<p>写cpu_data.txt到mydb数据库：</p>

<pre><code>curl -i -XPOST 'http://localhost:8086/write?db=mydb' --data-binary @cpu_data.txt
</code></pre>

<h4 id="2-1-5-a-name-schemalessdesign-12-a-schemaless-design">2.1.5. <a name='SchemalessDesign-12'></a>Schemaless Design</h4>

<p>InfluxDB是一个Schemaless的数据库。您可以随时添加measurements, tags, 和 fields。但需要注意的是，如果你试图写入不同的数据类型到之前用过的数据库
（例如，写一个字符串到以前接受整型的字段，InfluxDB将拒绝这些数据。</p>

<h4 id="2-1-6-a-name-rest-13-a-关于rest">2.1.6. <a name='REST...-13'></a>关于REST&hellip;</h4>

<p>InfluxDB使用HTTP仅作为一种方便和广泛支持的数据传输协议。InfluxDB API并没有试图成为RESTful的。</p>

<h4 id="2-1-7-a-name-http-14-a-http响应概要">2.1.7. <a name='HTTP-14'></a>HTTP响应概要</h4>

<ul>
<li>2XX：如果<code>HTTP 204 No Content</code>，请求成功了！如果它是HTTP 200 OK，InfluxDB理解了请求，但不能完成它。响应的BODEY会包含其他错误信息。</li>
<li>4XX：InfluxDB无法理解的请求。</li>
<li>5XX：系统超载有严重错误。</li>
</ul>

<p>错误响应示例：
- 写入float到以前接受bool的字段：</p>

<pre><code>curl -i -XPOST 'http://localhost:8086/write?db=hamlet' --data-binary 'tobeornottobe booleanonly=true'  

curl -i -XPOST 'http://localhost:8086/write?db=hamlet' --data-binary 'tobeornottobe booleanonly=5'
</code></pre>

<p>返回：</p>

<pre><code>HTTP/1.1 400 Bad Request
[...]
write failed: field type conflict: input field &quot;booleanonly&quot; on measurement &quot;tobeornottobe&quot; is type float64, already exists as type boolean
</code></pre>

<p>写入一个不存在的数据库</p>

<pre><code>curl -i -XPOST 'http://localhost:8086/write?db=atlantis' --data-binary 'liters value=10'
</code></pre>

<p>返回</p>

<pre><code>HTTP/1.1 404 Not Found
[...]
database not found: &quot;atlantis&quot;
</code></pre>

<h3 id="2-2-a-name-15-a-查询数据">2.2. <a name='-15'></a>查询数据</h3>

<h4 id="2-2-1-a-name-httpapi-16-a-使用-http-api查询数据">2.2.1. <a name='HTTPAPI-16'></a>使用 HTTP API查询数据</h4>

<p>HTTP API是查询InfluxDB数据的主要方式（参见command line interface 和 client libraries 等替代方式来查询数据库）。</p>

<p>要执行一个查询，发送<code>GET</code>请求到<code>/query</code>，设置URL参数db作为目标数据库，并设置URL参数q作为查询。下面的示例使用HTTP API来查询您在上一节写入的数据。</p>

<pre><code>curl -GET 'http://localhost:8086/query?pretty=true' --data-urlencode &quot;db=mydb&quot; --data-urlencode &quot;q=SELECT value FROM cpu_load_short WHERE region='us-west'&quot;
</code></pre>

<p>InfluxDB返回JSON。查询的结果显示在“results”数组中。如果发生错误，会有一个“error”字段来解释错误原因。</p>

<pre><code>{
    &quot;results&quot;: [
        {
            &quot;series&quot;: [
                {
                    &quot;name&quot;: &quot;cpu_load_short&quot;,
                    &quot;columns&quot;: [
                        &quot;time&quot;,
                        &quot;value&quot;
                    ],
                    &quot;values&quot;: [
                        [
                            &quot;2015-01-29T21:55:43.702900257Z&quot;,
                            0.55
                        ],
                        [
                            &quot;2015-01-29T21:55:43.702900257Z&quot;,
                            23422
                        ],
                        [
                            &quot;2015-06-11T20:46:02Z&quot;,
                            0.64
                        ]
                    ]
                }
            ]
        }
    ]
}

</code></pre>

<p> 
&gt; 注：追加pretty=true添加到URL能够漂亮的打印JSON输出。虽然这对调试很有用，不建议在生产中使用，因为它消耗了不必要的网络带宽。</p>

<h4 id="2-2-2-a-name-17-a-多个查询">2.2.2. <a name='-17'></a>多个查询</h4>

<p>可以在一个API调用种发送多个查询。只需用分号分割每个查询语句：</p>

<pre><code>curl -G 'http://localhost:8086/query?pretty=true' --data-urlencode &quot;db=mydb&quot; --data-urlencode &quot;q=SELECT value FROM\
 cpu_load_short WHERE region='us-west';SELECT count(value) FROM cpu_load_short WHERE region='us-west'&quot;
</code></pre>

<p>返回</p>

<pre><code>{
    &quot;results&quot;: [
        {
            &quot;series&quot;: [
                {
                    &quot;name&quot;: &quot;cpu_load_short&quot;,
                    &quot;columns&quot;: [
                        &quot;time&quot;,
                        &quot;value&quot;
                    ],
                    &quot;values&quot;: [
                        [
                            &quot;2015-01-29T21:55:43.702900257Z&quot;,
                            0.55
                        ],
                        [
                            &quot;2015-01-29T21:55:43.702900257Z&quot;,
                            23422
                        ],
                        [
                            &quot;2015-06-11T20:46:02Z&quot;,
                            0.64
                        ]
                    ]
                }
            ]
        },
        {
            &quot;series&quot;: [
                {
                    &quot;name&quot;: &quot;cpu_load_short&quot;,
                    &quot;columns&quot;: [
                        &quot;time&quot;,
                        &quot;count&quot;
                    ],
                    &quot;values&quot;: [
                        [
                            &quot;1970-01-01T00:00:00Z&quot;,
                            3
                        ]
                    ]
                }
            ]
        }
    ]
}

</code></pre>

<h4 id="2-2-3-a-name-18-a-查询数据的其他选项">2.2.3. <a name='-18'></a>查询数据的其他选项</h4>

<h5 id="时间戳格式timestamp-format">时间戳格式Timestamp Format</h5>

<p>在InfluxDB所有东西都被存为UTC格式。默认情况下，时间戳以RFC3339 UTC格式返回并提供纳秒级的精度，例如<code>2015-08-04T19：05：14.318570484Z</code>。
如果你需要 Unix epoch format可以设置查询字符串参数<code>epoch = [H，M，S，MS，U，NS]</code>。例如，获取秒单位时间戳：</p>

<pre><code>curl -G 'http://localhost:8086/query' --data-urlencode &quot;db=mydb&quot; --data-urlencode &quot;epoch=s&quot;\
 --data-urlencode &quot;q=SELECT value FROM cpu_load_short WHERE region='us-west'&quot;
</code></pre>

<h5 id="鉴权authentication">鉴权Authentication</h5>

<p>Authentication in InfluxDB is disabled by default. See Authentication and Authorization for how to enable and set up authentication.</p>

<h5 id="最大行数maximum-row-limit">最大行数Maximum Row Limit</h5>

<p>最大行限制InfluxDB返回的结果的最大数量。默认设置为10,000，并且可以通过在配置文件的HTTP部分修改。
最大行限制仅适用于非分块查询。分块查询可以返回点的数量不受限制。</p>

<h5 id="分片chunking">分片Chunking</h5>

<p>通过设置<code>chunked=true</code>来使用分块组块，用于返回streamed batches形式的结果，而不是单个resposne返回所有数据。
resposne将被按照series 或每10000个point分片。设置<code>chunk_size</code>来改变最大块大小为不同的值
,例如：</p>

<pre><code>curl -G 'http://localhost:8086/query' --data-urlencode &quot;db=deluge&quot; --data-urlencode=&quot;chunked=true&quot; --data-urlencode &quot;chunk_size=20000&quot; \
--data-urlencode &quot;q=SELECT * FROM liters&quot;
</code></pre>

<h3 id="2-3-a-name-downsamplinganddataretention-19-a-缩减采样和数据保留-downsampling-and-data-retention">2.3. <a name='DownsamplingandDataRetention-19'></a>缩减采样和数据保留（Downsampling and Data Retention）</h3>

<p>InfluxDB每秒能够处理成千上万的数据点。长时间运行将会消耗大量存储空间。一个自然的解决方案是：缩减采样数据;
只在有限的时间内保持高精度的原始数据，更长时间的数据则存储精度较低，汇总数据。
本节说明了如何结合两个InfluxDB功能 - 保留策略和连续查询（retention policies and continuous queries） - 来自动缩减采样和淘汰数据。</p>

<h4 id="2-3-1-a-name-retentionpolicies-20-a-保留策略retention-policies">2.3.1. <a name='retentionpolicies-20'></a>保留策略retention policies</h4>

<h5 id="定义">定义</h5>

<p>保留策略retention policy（RP）是InfluxDB的一种数据结构，用于描述InfluxDB保留数据多久（持续时间）和有多少数据副本存储在集群中（复制因子
replication factor）。一个数据库可以有多个RP，RP在每个数据库唯一。</p>

<h5 id="目的">目的</h5>

<p>一般来说InfluxDB不是为删除数据设计的。一个基本假设是，删除不频繁并且不必有高性能。然而，InfluxDB意识到清理过期数据
的必要性 &mdash; 这就是RPs的目的。</p>

<h5 id="使用rps">使用RPs</h5>

<p>当您创建一个数据库的时候，InfluxDB自动创建一个名为<code>default</code>的具有无限持续时间，并设置复制因子为1的RP，并且把它作为
默认<code>DEFAULT</code>PR。当你写数据的时候没有提供一个明确的RP，数据会被设置为DEFAULT RP。</p>

<p>InfluxDB自动查询并写入到DEFAULT RP的数据库。要查询或写入到不同的RP，你必使用<code>&lt;database_name&gt;.&quot;&lt;retention_policy&gt;&quot;.&lt;measurement_name&gt;</code>
来完整的限定 database，retention policy 和 measurement name。</p>

<h4 id="2-3-2-a-name-21-a-连续查询">2.3.2. <a name='-21'></a>连续查询</h4>

<h5 id="定义-1">定义</h5>

<p>连续查询continuous query（CQ）是一个数据库中自动定期运行的InfluxQL查询。CQs需要一个<code>SELECT</code>子句带有<code>GROUP BY time()</code>
。 InfluxDB存储CQ的结果在一个的特定的measurement里。</p>

<h5 id="目的-1">目的</h5>

<p>CQs是定期缩减采样数据的最佳方案 - 一旦你执行CQ，InfluxDB运行定期的执行查询，不同于一个简单地返回结果的正常的查询，
InfluxDB把CQ的结果存储下来用于未来使用。</p>

<h5 id="使用cqs">使用CQs</h5>

<p>See Continuous Queries for a detailed discussion on how to create and manage CQs.</p>

<h4 id="2-3-3-a-name-rpsandcqs-22-a-结合-rps-and-cqs-一个案例研究">2.3.3. <a name='RPsandCQs--22'></a>结合 RPs and CQs - 一个案例研究</h4>

<p>我们有通过电话，并通过网站以10秒间隔追踪食品订单到餐馆数量的实时数据。从长远来看，我们只关心30分钟时间间隔的数据。
在接下来的步骤中，我们使用RP和CQ，使InfluxDB：
- 自动删除两个小时以前的10秒级原始数据
- 自动汇总10秒数据到30分钟级数据
- 永久保留30分钟级数据</p>

<p>处理的数据格式
- db=food_data
- measurement=orders
- fields=phone, website</p>

<h5 id="准备数据库">准备数据库</h5>

<blockquote>
<p>在插入数据之前进行下面的两步，因为只有InfluxDB新数据进行CQ，也就是创建CQ之后产生的数据，</p>
</blockquote>

<h5 id="创建-default-rp">创建<code>DEFAULT</code> RP</h5>

<p>我们希望DEFAULT RP是一个两小时的策略，而不是默认的<code>default</code>策略：</p>

<pre><code>&gt; CREATE RETENTION POLICY two_hours ON food_data DURATION 2h REPLICATION 1 DEFAULT
</code></pre>

<pre><code>&gt; SHOW RETENTION POLICIES ON food_data
name		      duration	  replicaN	  default
default		   0		        1		        false
two_hours	  2h0m0s		   1		        true
</code></pre>

<h5 id="创建cq">创建CQ</h5>

<p>现在我们创建自动的缩减采样10秒级数据到30分钟级别的CQ</p>

<pre><code>&gt; CREATE CONTINUOUS QUERY cq_30m ON food_data BEGIN SELECT mean(website) AS mean_website,mean(phone)\
 AS mean_phone INTO food_data.&quot;default&quot;.downsampled_orders FROM orders GROUP BY time(30m) END
</code></pre>

<blockquote>
<p>注意指明了使用default RP，而不是two_hours RP</p>
</blockquote>

<h5 id="写入数据-查看结果">写入数据，查看结果</h5>

<p>写入数据到food_data一段时间后我们可以看到两个measurements：orders 和 downsampled_orders</p>

<p>orders中的是10秒级别的two_hours RP下的原始数据：</p>

<pre><code>&gt; SELECT * FROM orders LIMIT 5
name: orders
-----------------
time						            phone 	website
2015-12-04T20:00:11Z	 1	     6
2015-12-04T20:00:20Z		9	     10
2015-12-04T20:00:30Z		2	     17
2015-12-04T20:00:40Z		3	     10
2015-12-04T20:00:50Z		1	     15
</code></pre>

<p>我们在12/04/2015 at 22:08:19 UTC提交这个查询 - 发现最早的数据是不超过大约两小时前的时间戳。</p>

<blockquote>
<p>注：默认情况下，InfluxDB每隔30分钟检查执行RP。这是一个可配置的设置，请参阅数据库配置。</p>
</blockquote>

<p>downsampled_orders中的是default RP下的历史30分钟级别数据：</p>

<pre><code>&gt; SELECT * FROM food_data.&quot;default&quot;.downsampled_orders LIMIT 5
name: downsampled_orders
------------------------
time			               mean_phone		       mean_website
2015-12-03T22:30:00Z	 4.318181818181818	 9.254545454545454
2015-12-03T23:00:00Z	 4.266666666666667	 9.827777777777778
2015-12-03T23:30:00Z	 4.766666666666667	 9.677777777777777
2015-12-04T00:00:00Z	 4.405555555555556	 8.5
2015-12-04T00:30:00Z	 4.788888888888889	 9.383333333333333
</code></pre>

<p>请注意，在downsampled_orders时间戳为30分钟的时间间隔，并且比orders旧的时间戳。</p>

<h3 id="2-4-a-name-23-a-硬件指南">2.4. <a name='-23'></a>硬件指南</h3>

<p>略</p>

<h2 id="3-a-name-24-a-概念">3. <a name='-24'></a>概念</h2>

    </div>

    <footer>
        <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    

                    

                    
                        Category
                    
                
            </li>
        
    

    
    
        <li><a href='/categoriesdb'>Db</a></li>
    
</ul>

    </footer>
</article>
<ul class="actions pagination">
    
        <li><a href="https://u2takey.github.io/blog/first/"
                class="button big previous">first blog</a></li>
    

    
</ul>



    
        <article class="post">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'shortname';
    var disqus_identifier = 'https:\/\/u2takey.github.io\/blog\/influxdb%E4%B8%AD%E6%96%87%E7%B2%BE%E7%AE%80%E6%96%87%E6%A1%A3\/';
    var disqus_title = 'influxdb中文精简文档';
    var disqus_url = 'https:\/\/u2takey.github.io\/blog\/influxdb%E4%B8%AD%E6%96%87%E7%B2%BE%E7%AE%80%E6%96%87%E6%A1%A3\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>
    



            <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li><a href="//twitter.com/share?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&text=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3&via=" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&title=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&title=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f&title=influxdb%e4%b8%ad%e6%96%87%e7%b2%be%e7%ae%80%e6%96%87%e6%a1%a3" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by leiiwang&body=https%3a%2f%2fu2takey.github.io%2fblog%2finfluxdb%25E4%25B8%25AD%25E6%2596%2587%25E7%25B2%25BE%25E7%25AE%2580%25E6%2596%2587%25E6%25A1%25A3%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
</section>

        
    </div>
    
<section id="sidebar">

    
        <section id="intro">
            
            
                
                    <img src="/img/main/logo.jpg" class="intro-circle" width="100pix" alt="Hugo Future Imperfect" />
                
            
            
                <header>
                    <h2>LeiiWang&#39;s Blog</h2>
                    <p>时光如河水流过，一些沙子在这里沉淀。</p>
                </header>
            
            <ul class="icons">
                
                    <li><a href="https://u2takey.github.io/index.xml" type="application/rss+xml"
                        target="_blank" title="RSS" class="fa fa-rss"></a></li>
                
                
                    
<li><a href="//github.com/u2takey" target="_blank" title="GitHub" class="fa fa-github"></a></li>




















































                
            </ul>
        </section>

    
        <section id="recent-posts">
            <ul class="posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://u2takey.github.io/blog/influxdb%E4%B8%AD%E6%96%87%E7%B2%BE%E7%AE%80%E6%96%87%E6%A1%A3/">influxdb中文精简文档</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-07-31'>
                                    July 31, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://u2takey.github.io/blog/first/">first blog</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-07-24'>
                                    July 24, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://u2takey.github.io/blog/golang_faq/">Golang笔记之常见问题</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-04-01'>
                                    April 1, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://u2takey.github.io/blog/launchd/">Launchd Tutorial</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-04-01'>
                                    April 1, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="https://u2takey.github.io/blog/coredata/">CoreData概要</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2015-02-01'>
                                    February 1, 2015</time>
                            </header>
                        </article>
                    </li>
                

                
                    <li>
                        <ul class="actions">
                            <li><a href=
                            
                                /blog/
                            
                            class="button">View more posts</a></li>
                        </ul>
                    </li>
                
            </ul>
        </section>

    
    
    
    
        <section id="categories">
            <ul class="posts">
                <header>
                    <h3><a href="/categories/">Categories</a></h3>
                </header>

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/ios--macos/">IOS &amp; MacOS</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/%E9%9A%8F%E6%84%9F/">随感</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/db/">Db</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/golang/">Golang</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
            </ul>
        </section>
    

    
        
        <section class="blurb">
            <h2>About</h2>
            <p>又一个博客.</p>

            <ul class="actions">
                <li><a href="/about/" class="button">Learn More</a></li>
            </ul>
        </section>
        

    
        <section id="footer">
            <ul class="icons">
                
                    <li><a href="https://u2takey.github.io/index.xml" type="application/rss+xml"
                        target="_blank" title="RSS" class="fa fa-rss"></a></li>
                
                
                    
<li><a href="//github.com/u2takey" target="_blank" title="GitHub" class="fa fa-github"></a></li>




















































                
            </ul>

            <p class="copyright">&copy; LeiiWang&#39;s Blog. Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a>. Ported by <a href="//github.com/jpescador" target="_blank">Julio Pescador</a>. Powered by <a href="//gohugo.io" target="_blank">Hugo</a></p>
        </section>

</section>

            </div>
        <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
        

        
        
            
        

        
        

        
            
                
                    <script src="/js/main.min.js"></script>
                
            
                
                    <script src="/js/autohidingnavbar.js"></script>
                
            
        

            
            <script>hljs.initHighlightingOnLoad();</script>
            <script>(function($){
  $(function(){ 
    var scroll = $(document).scrollTop();
    var headerHeight = $('.header').outerHeight();
    $(window).scroll(function() {
      var scrolled = $(document).scrollTop();
      if ((scrolled - scroll) > 50 && scrolled > headerHeight){
         $('#header').hide();
      } else if((scroll - scrolled) > 100 || scrolled < headerHeight * 2) {
         $('#header').show();
      } 
      console.log(scrolled - scroll);          
      scroll = $(document).scrollTop(); 
      
     });

   });
})(jQuery);;</script>
            
    </body>
</html>

